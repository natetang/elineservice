

tosca_definitions_version: tosca_simple_yaml_1_0

imports:
   - custom_types/slice.yaml
   - custom_types/site.yaml
   - custom_types/image.yaml
   - custom_types/flavor.yaml
   - custom_types/network.yaml
   - custom_types/networktemplate.yaml
   - custom_types/networkslice.yaml
   - custom_types/elineservice.yaml
   - custom_types/elineserviceinstance.yaml

description: configure elineservice

topology_template:
  node_templates:

# site, image, fully created in deployment.yaml
    mysite:
      type: tosca.nodes.Site
      properties:
        must-exist: true
        name: mysite

    m1.small:
      type: tosca.nodes.Flavor
      properties:
        name: m1.small
        must-exist: true

    trusty-server-multi-nic:
      type: tosca.nodes.Image
      properties:
        name: trusty-server-multi-nic
        must-exist: true

# private network template, fully created somewhere else
    private:
      type: tosca.nodes.NetworkTemplate
      properties:
        must-exist: true
        name: Private

# management networks, fully created in management-net.yaml
    management_network:
      type: tosca.nodes.Network
      properties:
        must-exist: true
        name: management

# public network, fully created somewhere else
    public_network:
      type: tosca.nodes.Network
      properties:
        must-exist: true
        name: public

    elineservice_network:
      type: tosca.nodes.Network
      properties:
          name: elineservice_network
          labels: elineservice_private_network
      requirements:
          - template:
              node: private
              relationship: tosca.relationships.BelongsToOne
          - owner:
              node: mysite_elineservice
              relationship: tosca.relationships.BelongsToOne

# CORD Slices
    mysite_elineservice:
      description: Eline Service Slice
      type: tosca.nodes.Slice
      properties:
          name: mysite_elineservice
          default_isolation: vm
          network: noauto
      requirements:
          - site:
              node: mysite
              relationship: tosca.relationships.BelongsToOne
          - service:
              node: elineservice
              relationship: tosca.relationships.BelongsToOne
          - default_image:
              node: trusty-server-multi-nic
              relationship: tosca.relationships.BelongsToOne
          - default_flavor:
              node: m1.small
              relationship: tosca.relationships.BelongsToOne

# CORD NetworkSlices
    elineservice_slice_management_network:
      type: tosca.nodes.NetworkSlice
      requirements:
        - network:
            node: management_network
            relationship: tosca.relationships.BelongsToOne
        - slice:
            node: mysite_elineservice
            relationship: tosca.relationships.BelongsToOne

    elineservice_slice_public_network:
      type: tosca.nodes.NetworkSlice
      requirements:
        - network:
            node: public_network
            relationship: tosca.relationships.BelongsToOne
        - slice:
            node: mysite_elineservice
            relationship: tosca.relationships.BelongsToOne

    elineservice_slice_elineservice_network:
      type: tosca.nodes.NetworkSlice
      requirements:
        - network:
            node: elineservice_network
            relationship: tosca.relationships.BelongsToOne
        - slice:
            node: mysite_elineservice
            relationship: tosca.relationships.BelongsToOne

    elineservice:
      type: tosca.nodes.ElineService
      properties:
        name: elineservice
        public_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCrlyrCEpdeOEzIb52wFma4JTBSgnXiwYkpXGZh7SOrFf00Ynn2ADEmKX9vQASYeP79A6EOJ5yieseD77Rt/4HfRkwbKO8sG4tn+zaml9ifJQOh/OCMAbWRmNmpiPyq585wPoMTWLMmgUIsa2kIHIzpVcCn+Zz5qasNgu4PpCtsUTTEqEJcY2y1Ufc21/Jel+gd8A+y3iQd5Y6196gasUMMGRTIE32vR0LpqkiMZ5cRlckCFpC2I9tR4+opKgd72X7XOk0pWHDV9xRvT0IiwLLAQlY/J+YqO+UG1hEi+mfavGteGJ3fZ2OfWGEzVVcs+ZsjZF5QWFdQ2LDsC81E1MuFSKfEABUSQEPznq6v3BUNtYbhRRlPheouE/ntmJkpMepHjF8bwHy5rtauz9iqCUg8Mc5e35akIoyu8Kvm3/K0H/luZkUSqihRoK5SZHgERsfJQg2+BCawW3fMIm/BnZBF8B1Dw/qPRRfCSikUTeORrX+rgrWOkktYLDFyTqAbHvTzA8ouqHXKtiPVUVLAGDOmPlOxev3YxfEbbozxWvdtvjTmNaQXxjlZbOFO1O6SQj02gfAYgo+11ZWlEh0fzVoAjJ7SjPAJdJid+gBta4Fdzly0PbdWUxX3Wa8Mg1SstMUlQzOCx1rtc5LnfpjtJR+lO2Ho4cGi+jy7X/GGym/7Rw== CORD SSH client key for headnode
        private_key_fn: /opt/xos/services/elineservice/keys/elineservice_rsa
        service_message: hello

    elinetenant1:
      type: tosca.nodes.ElineServiceInstance
      properties:
        name: elinetenant1
        tenant_message: world
      requirements:
        - owner:
            node: elineservice
            relationship: tosca.relationships.BelongsToOne

